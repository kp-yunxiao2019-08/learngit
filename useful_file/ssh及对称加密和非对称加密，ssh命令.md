### ssh http://www.fangyuba.com/news/dynamic/478.htm
-	SSH是一种用于安全访问远程服务器的网络协议。SSH服务其实是一个守护进程(demon)，系统后台会监听客户端的连接，ssh服务端的进程名为sshd，负责实时监听客户端的请求(IP 22端口)，包括公共秘钥等交换等信息。SSH服务端由2部分组成：openssh(提供ssh服务)、openssl(提供加密的程序)。

#### **对称加密**和**非对称加密**
- 对称加密

  -	客户端和服务端使用同一个密钥对数据进行加密和解密。
  -	优点：
    -	加密强度高
  -	缺点：
    -	秘钥容易泄露
  -	举例
    -	DES、3DES（TripleDES）、AES、RC2、RC4、RC5和Blowfish

- 非对称加密

  -	非对称加密中有两个密钥，公钥和私钥。这两个密钥配对产生和使用。用公钥加密的数据，必须用与其对应的私钥才能解开。并且，私钥无法通过公钥获取。因此，公钥是可以被公开的，而私钥则必须被安全存放。
  -	在SSH中，非对称加密被用来在会话初始化阶段为通信双方进行会话密钥的协商。由于非对称加密的计算量开销比较大，因此一旦双方的会话密钥协商完成，后续的加密都将采用对称加密来进行
  -	举例
    -	RSA、Elgamal、背包算法、Rabin、D-H、ECC（椭圆曲线加密算法)

- ssh建立过程

  - 简单过程

    - 客户端向远程端服务器发出登陆请求；
    - 远程服务器将自己的公钥返给客户端；
    - 客户端使用公钥将账户密码加密，然后发送给远程服务器；
    - 服务器通过自己的私钥对密文进行解密，认证密码正确后，允许客户端登陆；
    
  - 大致过程

    -	在服务器启动的时候会产生一个密钥(也就是768bit公钥)，本地的ssh客户端发送连接请求到ssh服务器，服务器检查连接点客户端发送的数据和IP地址，确认合法后发送密钥(768bits公钥)给客户端，此时客户端将本地私钥(256bit)和服务器的公钥(768bit)结合成密钥对key(1024bit)，发回给服务器端，服务端利用自己的私钥解密，读取出客户端的本地私钥，建立连接通过key-pair数据传输，在此之后，服务端与客户端就愉快的使用客户端私钥进行沟通。

  - 客户端发起一个TCP连接，默认端口号为22.

  - 服务端收到连接请求后，将自己的一些关键信息发给客户端。这些信息包括：

    \- 服务端的公钥：客户端在收到这个公钥后，会在自己的“known_hosts”文件进行搜索。如果找到了相同的公钥，则说明此前连接过该服务器。如果没有找到，则会在终端上显示一段警告信息，由用户来决定是否继续连接。

    coderunner@geekyshacklebolt:~$ ssh geekyshacklebolt The authenticity of host 'geekyshacklebolt (192.168.42.222)' can't be established. ECDSA key fingerprint is SHA256:Ql/KnGlolY9eCGuYK3OX3opnSyJQzsbtM3DW/UZIxms. Are you sure you want to continue connecting (yes/no)?

    \- 服务器所支持的加密算法列表：客户端根据此列表来决定采用哪种加密算法。

  - 生成会话密钥。此时，客户端已经拥有了服务端的公钥。接下来，客户端和服务端需要协商出一个双方都认可的密钥，并以此来对双方后续的通信内容进行加密。

    密钥协商是通过Diffie - Hellman算法来实现的。具体过程是：

    1）服务端和客户端共同选定一个大素数，叫做种子值；

    2）服务端和客户端各自独立地选择另外一个只有自己才知道的素数；

    3）双方使用相同的加密算法（如AES），由种子值和各自的私有素数生成一个密钥值，并将这个值发送给对方；

    4）在收到密钥值后，服务端和客户端根据种子值和自己的私有素数，计算出一个最终的密钥。这一步由双方分别独立进行，但是得到的结果应该是相同的。

    5）双方使用上一步得到的结果作为密钥来加密和解密通信内容。

  - 客户端将自己的公钥id发送给服务端，服务端需要对客户端的合法性进行验证：

    1）服务端在自己的“authorized_keys”文件中搜索与客户端匹配的公钥。

    2）如果找到了，服务端用这个公钥加密一个随机数，并把加密后的结果发送给客户端。

    3）如果客户端持有正确的私钥，那么它就可以对消息进行解密从而获得这个随机数。

    4）客户端由这个随机数和当前的会话密钥共同生成一个MD5值。

    5）客户端把MD5值发给服务端。

    6）服务端同样用会话密钥和原始的随机数计算MD5值，并与客户端发过来的值进行对比。如果相等，则验证通过。

-	ssh命令

  -	SSH命令最简单的用法只需要指定用户名和主机名参数即可，主机名可以是 IP 地址或者域名。
    
    -	ssh root@192.168.0.1 
    
  -	SSH 默认连接到目标主机的 22 端口上，我们可以使用 -p 选项指定端口号。
    
    -	ssh -p 22 root@192.168.0.1 
    
  -	使用 SSH 在远程主机执行一条命令并显示到本地，然后继续本地工作，只需要直接连接并在后面加上要执行的命令。
    
    -	ssh -p 22 root@192.168.0.1 ls -l 
    
  -	在远程主机运行一个图形界面的程序，只需使用SSH的-X选项，然后主机就会开启 X11转发功能。
    
    -	ssh -X 22 root@192.168.0.1 
    
  -	如果你的客户端有多于两个以上的 IP 地址，你就不可能分得清楚在使用哪一个 IP 连接到 SSH 服务器。为了解决这种情况，我们可以使用 -b 选项来指定一个IP 地址。这个 IP 将会被使用做建立连接的源地址
    
    -	ssh -b 192.168.0.200 root@192.168.0.103 
    
  -	使用 -C 选项，所有通过 SSH 发送或接收的数据将会被压缩，并且仍然是加密的。
    
    -	ssh -C 192.168.0.200 root@192.168.0.103 
    
  -	打开调试模式
    
    -	ssh -v root@192.168.0.103
    
  - SSH免密登陆
  
    -	通过 ssh-keygen 生成本地公钥和私钥，将公钥Copy到远程服务器就可以。
  
  - 构建 SSH 密钥对
  
    -	使用 ssh-keygen -t +算法名，现在大多数都使用 RSA 或者 DSA 算法。如果你在安装Git时已经做过此步骤，那么忽略这一步即可。
      - ssh-keygen -t rsa
  
  -	**拷贝本地公钥给远程服务器**
  
    -	ssh-copy-id root@192.168.25.110
      -	通过参数 -i 指定公钥文件:	
        -	ssh-copy-id -i id_dsa.pub omd@192.168.25.110 
  
  -	查看是否已经添加了对应主机的密钥 : -F
  
    -	ssh-keygen -F 192.168.0.1 
  
  -	**删除主机密钥**
  
    -	使用-R选项，也可以在 ~/.ssh/known_hosts 文件中手动删除
  
      ```
      ssh-keygen -R 192.168.0.1 
      ```

- **如何配置 SSH**

  SSH 的配置文件在 /etc/ssh/sshd_config 中，你可以看到端口号，空闲超时时间等配置项。

  ```
  cat /etc/ssh/sshd_config 
  ```

  - /etc/ssh/sshd_config [配置详细说明]http://www.fangyuba.com/news/dynamic/478.htm